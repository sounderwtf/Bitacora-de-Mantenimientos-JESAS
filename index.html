<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Bitácoras</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@tailwindcss/browser@latest"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #ffffff;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            position: relative;
        }

        h1 {
            color: #34495e;
            text-align: center;
            margin-top: 20px;
            font-size: 24px;
        }

        .menu-principal {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
            width: 100%;
            padding: 0 10px;
        }

        .menu-principal button {
            padding: 14px 24px;
            font-size: 18px;
            margin: 8px 0;
            cursor: pointer;
            background-color: #b0e0e6;
            color: #2c3e50;
            border: none;
            border-radius: 12px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
            text-align: center;
            transition: background-color 0.3s ease, transform 0.2s ease;
            font-weight: 500;
            width: 100%;
            max-width: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .menu-principal button:hover {
            background-color: #87ceeb;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .menu-principal button:nth-child(3) {
            background-color: #ffa500;
            color: #2c3e50;
        }

        .menu-principal button:nth-child(3):hover {
            background-color: #ff8c00;
        }

        .formulario-container {
            background-color: #FFFFFF;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            display: none;
            width: 95%;
            max-width: 600px;
        }

        label {
            display: block;
            margin-top: 15px;
            font-weight: bold;
            font-size: 16px;
            color: #7f8c8d;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            margin-top: 8px;
            margin-bottom: 20px;
            border: 1px solid #bdc3c7;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 16px;
            color: #2c3e50;
        }

        input:focus, select:focus, textarea:focus {
            border-color: #3498db;
            outline: none;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .custom-form-container {
            background-color: #f7fafc;
            border-radius: 0.5rem;
            padding: 2rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            max-width: 800px;
            margin: 0 auto;
        }
        .custom-form-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }
        .custom-form-title {
            font-size: 1.875rem;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 0.5rem;
        }
        .custom-form-description {
            font-size: 1rem;
            color: #4a5568;
        }
        .custom-form-group {
            margin-bottom: 1.25rem;
        }
        .custom-form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 0.25rem;
        }
        .custom-input, .custom-select {
            display: block;
            width: 100%;
            padding: 0.75rem;
            font-size: 1rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.375rem;
            transition: border-color 0.15s ease-in-out, shadow-sm 0.15s ease-in-out;
            outline: none;
        }
        .custom-input:focus, .custom-select:focus {
            border-color: #3182ce;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.2);
        }
        .custom-input::placeholder {
            color: #a0aec0;
        }
        .custom-button {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 0.375rem;
            color: white;
            background-color: #f56565; /* Color principal para enviar */
            transition: background-color 0.15s ease-in-out, transform 0.1s ease-in-out;
            cursor: pointer;
            border: none;
            display: block;
            width: 100%;
            text-align: center;
            margin-top: 1rem; /* Espacio superior para los botones */
        }
        .custom-button:hover {
            background-color: #c53030;
            transform: translateY(-1px);
        }
        .custom-button:disabled {
            background-color: #a0aec0;
            cursor: not-allowed;
            opacity: 0.7;
            transform: none;
        }
        /* Estilo específico para el botón de limpiar con custom-button */
        .custom-button.limpiar-button {
            background-color: #cbd5e0; /* Color gris claro para limpiar */
            color: #2d3748; /* Texto oscuro */
        }
        .custom-button.limpiar-button:hover {
            background-color: #a0aec0; /* Gris más oscuro al pasar el mouse */
        }
        /* Estilo específico para el botón de inicio con custom-button */
        .custom-button.home-button {
            background-color: #63b3ed; /* Un color azul para inicio */
            color: white;
        }
        .custom-button.home-button:hover {
            background-color: #4299e1;
        }

        /* Estilos específicos para la sección de maquinaria */
        #maquinariaForm {
            margin-top: 2rem;
        }

        /* Estilos para los campos de Camion Azul y Blanco */
        .camion-fields {
            display: none;
        }

        /* Estilos para los campos de las demás maquinarias */
        .otra-maquinaria-fields {
            display: none;
        }

        /* Estilos para el mensaje personalizado */
        .mensaje-personalizado {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #4CAF50; /* Color verde para éxito */
            color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 1000;
            text-align: center;
        }

        .info-empresa { /* Nuevo estilo para la información de la empresa */
            text-align: center;
            font-size: 16px;
            color: #555;
            margin-top: 5px;
            margin-bottom: 5px;
        }

        .contacto-soporte { /* Nuevo estilo para el contacto de soporte */
            text-align: center;
            font-size: 16px;
            color: #555;
            margin-top: 20px; /* Ajustado para que tenga más espacio del contenido de arriba */
            margin-bottom: 20px; /* Ajustado para que tenga más espacio del borde inferior */
        }
        .contacto-soporte a {
            color: #3498db;
            text-decoration: none;
            font-weight: bold;
        }
        .contacto-soporte a:hover {
            text-decoration: underline;
        }

        /* Estilos para la imagen */
        .imagen-inferior-centrada {
            display: block;
            margin-left: auto;
            margin-right: auto;
            margin-top: 20px;
            margin-bottom: 20px;
            max-width: 100%; /* Para que no se salga del contenedor */
            height: auto;
            text-align: center; /* Por si la imagen no ocupa todo el ancho */
        }
    </style>
    <script>
        // Función para obtener los parámetros de la URL. (No se usa en este código)
        function getUrlVars() {
            let vars = {};
            let parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m, key, value) {
                vars = value;
            });
            return vars;
        }

        // Función para enviar los datos del formulario a Google Sheets a través de Apps Script.
        async function enviarFormulario(formType) {
            console.log("DEBUG: La función enviarFormulario ha sido llamada para:", formType); 

            // *** IMPORTANTE: REEMPLAZA ESTA URL ***
            // Esta será la URL de tu aplicación web de Google Apps Script.
            // La obtendrás después de desplegar el script de Apps Script (Paso 2.5).
            const appsScriptUrl = "https://script.google.com/macros/s/AKfycbyxN4skJfh2DZzHTA3dL7ds4a64Wptna13iGNbt4WuvKEgOiujHcJvThGYyRMWsTihr/exec"; 

            let dataToSend = {}; // Objeto para almacenar los datos a enviar
            let isValid = true; // Variable para controlar la validación

            if (formType === "maquinaria") {
                // Validación para formulario de maquinaria
                const fields = ["fecha", "horometro", "quienRealiza", "tipoMantenimiento", "descripcionFalla", "operador", "tipoMaquinaria"];
                for (const fieldId of fields) {
                    const input = document.getElementById(fieldId);
                    if (input && input.value.trim() === '') {
                        mostrarMensaje(`Por favor, complete el campo: ${input.previousElementSibling.textContent.replace(':', '')}`);
                        isValid = false;
                        break;
                    }
                }
                if (!isValid) return;

                dataToSend = {
                    type: "maquinaria", // Identificador para Apps Script
                    fecha: document.getElementById("fecha").value,
                    horometro: document.getElementById("horometro").value,
                    quienRealiza: document.getElementById("quienRealiza").value,
                    tipoMantenimiento: document.getElementById("tipoMantenimiento").value,
                    descripcionFalla: document.getElementById("descripcionFalla").value,
                    operador: document.getElementById("operador").value,
                    notasMaq: document.getElementById("notas").value,
                    tipoMaquinaria: document.getElementById("tipoMaquinaria").value // Nombre completo de la maquinaria
                };
            } else if (formType === "vehiculos") {
                // Validación para formulario de vehículos
                const fields = ["fecha_reporte_vehiculo", "kilometraje", "quienRealiza_vehiculo", "tipoMantenimiento_vehiculo", "descripcionMantenimiento", "operador_vehiculo", "vehiculo"];
                for (const fieldId of fields) {
                    const input = document.getElementById(fieldId);
                    if (input && input.value.trim() === '') {
                        mostrarMensaje(`Por favor, complete el campo: ${input.previousElementSibling.textContent.replace(':', '')}`);
                        isValid = false;
                        break;
                    }
                }
                if (!isValid) return;

                dataToSend = {
                    type: "vehiculos", // Identificador para Apps Script
                    fechaReporte: document.getElementById("fecha_reporte_vehiculo").value,
                    kilometraje: document.getElementById("kilometraje").value,
                    quienRealiza: document.getElementById("quienRealiza_vehiculo").value,
                    tipoMantenimiento: document.getElementById("tipoMantenimiento_vehiculo").value,
                    descripcionMantenimiento: document.getElementById("descripcionMantenimiento").value,
                    operador: document.getElementById("operador_vehiculo").value,
                    notas: document.getElementById("notas_vehiculo").value,
                    vehiculo: document.getElementById("vehiculo").value
                };
            } else if (formType === "reporte") {
                console.log("DEBUG: Procesando formulario de REPORTE.");
                try {
                    const maquinaSeleccionada = document.getElementById('maquina').value;
                    console.log("DEBUG: maquinaSeleccionada:", maquinaSeleccionada);

                    if (!maquinaSeleccionada) {
                        mostrarMensaje("Por favor, seleccione la maquinaria.");
                        return; // Detener el envío si no se selecciona la maquinaria
                    }

                    dataToSend = {
                        type: "reporte",
                        maquinaSeleccionada: maquinaSeleccionada
                    };

                    // Validación específica para campos de camión
                    if (maquinaSeleccionada === 'camion_azul' || maquinaSeleccionada === 'camion_blanco') {
                        console.log("DEBUG: Maquinaria es camión (azul/blanco).");
                        // Validamos campos obligatorios para camiones, EXCLUYENDO 'numero_vale'
                        const camionFields = ["fecha_camion", "material", "obra_camion", "no_viajes", "capacidad", "chofer"];
                        for (const fieldId of camionFields) {
                            const input = document.getElementById(fieldId);
                            if (input && input.value.trim() === '') {
                                mostrarMensaje(`Por favor, complete el campo: ${input.previousElementSibling.textContent.replace(':', '')}`);
                                isValid = false;
                                break;
                            }
                        }
                        if (!isValid) return; // Detener si falta algún campo de camión

                        dataToSend.fechaRep = document.getElementById("fecha_camion").value;
                        console.log("DEBUG: fechaRep:", dataToSend.fechaRep);
                        dataToSend.material = document.getElementById("material").value;
                        console.log("DEBUG: material:", dataToSend.material);
                        dataToSend.obra = document.getElementById("obra_camion").value;
                        console.log("DEBUG: obra (camion):", dataToSend.obra);
                        dataToSend.noViajes = document.getElementById("no_viajes").value;
                        console.log("DEBUG: noViajes:", dataToSend.noViajes);
                        dataToSend.capacidad = document.getElementById("capacidad").value;
                        console.log("DEBUG: capacidad:", dataToSend.capacidad);
                        dataToSend.chofer = document.getElementById("chofer").value;
                        console.log("DEBUG: chofer:", dataToSend.chofer);
                        dataToSend.numeroVale = document.getElementById("numero_vale").value;
                        console.log("DEBUG: numeroVale:", dataToSend.numeroVale);
                        dataToSend.notasCamion = document.getElementById("notas_camion").value; // AGREGADO: Notas para camión
                        console.log("DEBUG: notasCamion:", dataToSend.notasCamion); // AGREGADO: Notas para camión
                        dataToSend.maquinaRep = maquinaSeleccionada === 'camion_azul' ? 'CAMION AZUL' : 'CAMION BLANCO';
                    } else { // Validación específica para otras maquinarias
                        console.log("DEBUG: Maquinaria es otra (no camión).");
                        const otraMaquinariaFields = ["fecha_otra", "horometro_salida", "horometro_regreso", "obra_otra", "operador_reporte_otra", "notas_otra"];
                        for (const fieldId of otraMaquinariaFields) {
                            const input = document.getElementById(fieldId);
                            if (input && input.value.trim() === '') {
                                mostrarMensaje(`Por favor, complete el campo: ${input.previousElementSibling.textContent.replace(':', '')}`);
                                isValid = false;
                                break;
                            }
                        }
                        if (!isValid) return; // Detener si falta algún campo de otra maquinaria

                        dataToSend.fechaRep = document.getElementById("fecha_otra").value;
                        console.log("DEBUG: fechaRep (otra):", dataToSend.fechaRep);
                        dataToSend.horometroSalida = document.getElementById("horometro_salida").value;
                        console.log("DEBUG: horometroSalida:", dataToSend.horometroSalida);
                        dataToSend.horometroRegreso = document.getElementById("horometro_regreso").value;
                        console.log("DEBUG: horometroRegreso:", dataToSend.horometroRegreso);
                        dataToSend.horasTrabajadas = document.getElementById("horas_trabajadas").value;
                        console.log("DEBUG: horasTrabajadas:", dataToSend.horasTrabajadas);
                        dataToSend.obra = document.getElementById("obra_otra").value;
                        console.log("DEBUG: obra (otra):", dataToSend.obra);
                        dataToSend.operadorReporte = document.getElementById("operador_reporte_otra").value;
                        console.log("DEBUG: operadorReporte:", dataToSend.operadorReporte);
                        dataToSend.notas = document.getElementById("notas_otra").value;
                        console.log("DEBUG: notas (otra):", dataToSend.notas);
                        
                        switch (maquinaSeleccionada) {
                            case 'moto_140h': dataToSend.maquinaRep = 'MOTO 140H'; break;
                            case 'moto_12g': dataToSend.maquinaRep = 'MOTO 12G'; break;
                            case 'retroexcavadora_580_super_n': dataToSend.maquinaRep = 'Retroexcavadora 580 SUPER N'; break;
                            case 'retroexcavadora_580_m': dataToSend.maquinaRep = 'Retroexcavadora 580 M'; break;
                            case 'retroexcavadora_cat_416d': dataToSend.maquinaRep = 'Retroexcavadora CAT 416D'; break;
                            case 'vibro_cat': dataToSend.maquinaRep = 'VIBRO CAT'; break;
                            case 'pipa_freightliner': dataToSend.maquinaRep = 'PIPA FREIGHTLINER'; break;
                            case 'pipa_kenworth': dataToSend.maquinaRep = 'PIPA KENWORTH'; break;
                            case 'pata_de_cabra_cp_553': dataToSend.maquinaRep = 'PATA DE CABRA CP-553'; break;
                            case 'bomba_achique_3': dataToSend.maquinaRep = 'BOMBA ACHIQUE 3\'\''; break;
                            default: dataToSend.maquinaRep = maquinaSeleccionada; break;
                        }
                    }
                } catch (error) {
                    console.error("ERROR en la recolección de datos del formulario de reporte:", error);
                    mostrarMensaje("Error interno al preparar los datos del formulario. Revisa la consola para más detalles.");
                    return false; // Detener el envío si hay un error en la recolección de datos
                }
            }

            console.log("DEBUG: Datos a enviar:", dataToSend); // Para depuración

            try {
                const response = await fetch(appsScriptUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded', 
                    },
                    body: new URLSearchParams(dataToSend).toString() 
                });

                // Leer la respuesta de texto de Apps Script
                const responseText = await response.text();
                console.log("DEBUG: Respuesta de Apps Script:", responseText); // Registrar la respuesta cruda

                if (responseText.startsWith("OK:")) {
                    mostrarMensaje("¡Formulario de " + formType + " enviado con éxito a Google Sheets!");
                    limpiarFormulario(formType);
                    mostrarInicio();
                } else if (responseText.startsWith("ERROR_HOROMETRO:")) { // Error específico de horómetro
                    mostrarMensaje("Error de Horómetro: " + responseText.replace("ERROR_HOROMETRO: ", ""));
                } else if (responseText.startsWith("ERROR:")) {
                    mostrarMensaje("Error al enviar el formulario de " + formType + ": " + responseText.replace("ERROR: ", ""));
                } else {
                    mostrarMensaje("Respuesta inesperada del servidor: " + responseText);
                }

            } catch (error) {
                console.error("DEBUG: Error de red al enviar el formulario de " + formType + ":", error);
                mostrarMensaje("Error de red al enviar el formulario de " + formType + ". Por favor, verifica tu conexión a Internet o la URL de Apps Script. Detalles: " + error.message);
            }

            return false; // Evita el envío tradicional del formulario HTML
        }

        // Función para limpiar los campos del formulario.
        function limpiarFormulario(formType) {
            if (formType === "maquinaria") {
                document.getElementById("fecha").value = "";
                document.getElementById("horometro").value = "";
                document.getElementById("quienRealiza").value = "";
                document.getElementById("tipoMantenimiento").value = "";
                document.getElementById("descripcionFalla").value = "";
                document.getElementById("operador").value = "";
                document.getElementById("notas").value = "";
                document.getElementById("tipoMaquinaria").value = "";
            } else if (formType === "vehiculos") {
                document.getElementById("fecha_reporte_vehiculo").value = "";
                document.getElementById("kilometraje").value = "";
                document.getElementById("quienRealiza_vehiculo").value = "";
                document.getElementById("tipoMantenimiento_vehiculo").value = "";
                document.getElementById("descripcionMantenimiento").value = "";
                document.getElementById("operador_vehiculo").value = "";
                document.getElementById("notas_vehiculo").value = "";
                document.getElementById("vehiculo").value = "";
            } else if (formType === "reporte") {
                const maquinaSeleccionada = document.getElementById('maquina').value;

                if (maquinaSeleccionada === 'camion_azul' || maquinaSeleccionada === 'camion_blanco') {
                    document.getElementById("fecha_camion").value = "";
                    document.getElementById("material").value = "";
                    document.getElementById("obra_camion").value = "";
                    document.getElementById("no_viajes").value = "";
                    document.getElementById("capacidad").value = "";
                    document.getElementById("chofer").value = "";
                    document.getElementById("numero_vale").value = ""; 
                    document.getElementById("notas_camion").value = ""; // AGREGADO: Limpiar notas para camión
                } else if (maquinaSeleccionada) {
                    document.getElementById("fecha_otra").value = "";
                    document.getElementById("horometro_salida").value = "";
                    document.getElementById("horometro_regreso").value = "";
                    document.getElementById("horas_trabajadas").value = "";
                    document.getElementById("obra_otra").value = "";
                    document.getElementById("operador_reporte_otra").value = "";
                    document.getElementById("notas_otra").value = "";
                }
                document.getElementById('maquina').value = "";
                const camionFields = document.getElementById('campos_camion');
                const otraMaquinariaFields = document.getElementById('campos_otra_maquinaria');
                if (camionFields) camionFields.style.display = 'none';
                if (otraMaquinariaFields) otraMaquinariaFields.style.display = 'none';
            }
        }

        // Función para mostrar un formulario específico.
        function mostrarFormulario(formType) {
            document.getElementById("formulario-container").style.display = "none";
            document.getElementById("menu-principal").style.display = "none";

            if (formType === "maquinaria") {
                document.getElementById("formulario-container").style.display = "flex";
                document.getElementById("formulario-container").innerHTML = `
                    <div class="custom-form-container">
                        <h2 class="custom-form-title">BITÁCORA DE MANTENIMIENTO DE MAQUINARIA</h2>
                        <form id="formulario-maquinaria">
                            <div class="custom-form-group">
                                <label for="fecha" class="custom-form-label">Fecha:</label>
                                <input type="date" id="fecha" name="fecha" class="custom-input">
                            </div>
                            <div class="custom-form-group">
                                <label for="tipoMaquinaria" class="custom-form-label">Tipo de Maquinaria:</label>
                                <select id="tipoMaquinaria" name="tipoMaquinaria" class="custom-select">
                                    <option value="">Seleccione una opción</option>
                                    <option value="VIBROCOMPACTADOR1 INGERSOLL SD100D C">Vibro Ingersoll Rand</option> <option value="RETROEXCAVADORA "1" EXT">Retro 580M</option> <option value="CAMION 2 T600">Camión Azul</option> <option value="PIPA1">Pipa Freightliner</option> <option value="CAMION 3">Camión Blanco</option> <option value="RETROEXCAVADORA3 580SN">RETROEXCAVADORA3 580SN</option>
                                    <option value="MOTONIVELADORA 140H "1"">Motoniveladora 140H "1"</option>
                                    <option value="MOTONIVELADORA 12G">MOTONIVELADORA 12G</option>
                                    <option value="VIBROCOMPACTADOR2 CATERPILLAR">VIBROCOMPACTADOR2 CATERPILLAR</option>
                                    <option value="PIPA2 T300">PIPA2 T300</option>
                                    <option value="COMPRESOR1">COMPRESOR1</option>
                                    <option value="COMPRESOR2">COMPRESOR2</option>
                                    <option value="COMPRESOR3">COMPRESOR3</option>
                                    <option value="DIRECCIONAL">DIRECCIONAL</option>
                                    <option value="PLATAFORMA">PLATAFORMA</option>
                                    <option value="TOPO">TOPO</option>
                                    <option value="PATA DE CABRA">PATA DE CABRA</option>
                                    <option value="RETROEXCAVADORA CAT 416D">RETROEXCAVADORA CAT 416D</option>
                                </select>
                            </div>
                            <div class="custom-form-group">
                                <label for="horometro" class="custom-form-label">Horómetro:</label>
                                <input type="text" id="horometro" name="horometro" class="custom-input">
                            </div>
                            <div class="custom-form-group">
                                <label for="quienRealiza" class="custom-form-label">Quién Realiza el Mantenimiento:</label>
                                <input type="text" id="quienRealiza" name="quienRealiza" class="custom-input">
                            </div>
                            <div class="custom-form-group">
                                <label for="tipoMantenimiento" class="custom-form-label">Tipo de Mantenimiento:</label>
                                <select id="tipoMantenimiento" name="tipoMantenimiento" class="custom-select">
                                    <option value="">Seleccione una opción</option>
                                    <option value="Preventivo">Preventivo</option>
                                    <option value="Correctivo">Correctivo</option>
                                </select>
                            </div>
                            <div class="custom-form-group">
                                <label for="descripcionFalla" class="custom-form-label">Descripción de la Falla:</label>
                                <textarea id="descripcionFalla" name="descripcionFalla" class="custom-input" rows="4"></textarea>
                            </div>
                            <div class="custom-form-group">
                                <label for="operador" class="custom-form-label">Operador:</label>
                                <input type="text" id="operador" name="operador" class="custom-input">
                            </div>
                            <div class="custom-form-group">
                                <label for="notas" class="custom-form-label">Notas:</label>
                                <textarea id="notas" name="notas" class="custom-input" rows="4"></textarea>
                            </div>
                            <button type="submit" class="custom-button">Enviar Formulario</button>
                            <button type="button" class="custom-button limpiar-button" onclick="limpiarFormulario('maquinaria')">Limpiar Formulario</button>
                            <button type="button" class="custom-button home-button" onclick="mostrarInicio()">Página de Inicio</button>
                        </form>
                    </div>
                `;
            } else if (formType === "vehiculos") {
                document.getElementById("formulario-container").style.display = "flex";
                document.getElementById("formulario-container").innerHTML = `
                    <div class="custom-form-container">
                        <h2 class="custom-form-title">BITÁCORA DE MANTENIMIENTO DE VEHÍCULOS</h2>
                        <form id="formulario-vehiculos">
                            <div class="custom-form-group">
                                <label for="fecha_reporte_vehiculo" class="custom-form-label">Fecha de Reporte:</label>
                                <input type="date" id="fecha_reporte_vehiculo" name="fecha_reporte_vehiculo" class="custom-input">
                            </div>
                            <div class="custom-form-group">
                                <label for="vehiculo" class="custom-form-label">Vehículo:</label>
                                <select id="vehiculo" name="vehiculo" class="custom-select">
                                    <option value="">Seleccione una opción</option>
                                    <option value="RAV4 2018">RAV4 2018</option>
                                    <option value="YARIS 2016">YARIS 2016</option>
                                    <option value="AVEO 2018">AVEO 2018</option>
                                    <option value="FORD-150 2014">FORD-150 2014</option>
                                    <option value="HILUX 1 2018">HILUX 1 2018</option>
                                    <option value="HILUX 2 2018">HILUX 2 2018</option>
                                    <option value="HILUX 3 2018">HILUX 3 2018</option>
                                    <option value="HILUX 4 2018">HILUX 4 2018</option>
                                    <option value="NP 300 2018">NP 300 2018</option>
                                    <option value="RAM700 2018">RAM700 2018</option>
                                    <option value="RAV4 LIMITEDHV 2021">RAV4 LIMITEDHV 2021</option>
                                </select>
                            </div>
                            <div class="custom-form-group">
                                <label for="kilometraje" class="custom-form-label">Kilometraje:</label>
                                <input type="text" id="kilometraje" name="kilometraje" class="custom-input">
                            </div>
                            <div class="custom-form-group">
                                <label for="quienRealiza_vehiculo" class="custom-form-label">Quién Realiza el Mantenimiento:</label>
                                <input type="text" id="quienRealiza_vehiculo" name="quienRealiza_vehiculo" class="custom-input">
                            </div>
                            <div class="custom-form-group">
                                <label for="tipoMantenimiento_vehiculo" class="custom-form-label">Tipo de Mantenimiento:</label>
                                <select id="tipoMantenimiento_vehiculo" name="tipoMantenimiento_vehiculo" class="custom-select">
                                    <option value="">Seleccione una opción</option>
                                    <option value="Preventivo">Preventivo</option>
                                    <option value="Correctivo">Correctivo</option>
                                </select>
                            </div>
                            <div class="custom-form-group">
                                <label for="descripcionMantenimiento" class="custom-form-label">Descripción del Mantenimiento:</label>
                                <textarea id="descripcionMantenimiento" name="descripcionMantenimiento" class="custom-input" rows="4"></textarea>
                            </div>
                            <div class="custom-form-group">
                                <label for="operador_vehiculo" class="custom-form-label">Operador:</label>
                                <input type="text" id="operador_vehiculo" name="operador_vehiculo" class="custom-input">
                            </div>
                            <div class="custom-form-group">
                                <label for="notas_vehiculo" class="custom-form-label">Notas:</label>
                                <textarea id="notas_vehiculo" name="notas_vehiculo" class="custom-input" rows="4"></textarea>
                            </div>
                            <button type="submit" class="custom-button">Enviar Formulario</button>
                            <button type="button" class="custom-button limpiar-button" onclick="limpiarFormulario('vehiculos')">Limpiar Formulario</button>
                            <button type="button" class="custom-button home-button" onclick="mostrarInicio()">Página de Inicio</button>
                        </form>
                    </div>
                `;
            } else if (formType === "reporte") {
                document.getElementById("formulario-container").style.display = "flex";
                document.getElementById("formulario-container").innerHTML = `
                    <div class="custom-form-container">
                        <h2 class="custom-form-title">REPORTE DE ACTIVIDADES DE MAQUINARIA</h2>
                        <form id="maquinariaForm">
                            <div class="custom-form-group">
                                <label for="maquina" class="custom-form-label">Seleccione Maquinaria:</label>
                                <select id="maquina" name="maquina" class="custom-select" onchange="mostrarCamposMaquinaria()">
                                    <option value="">Seleccione una opción</option>
                                    <option value="camion_azul">CAMIÓN AZUL</option>
                                    <option value="camion_blanco">CAMIÓN BLANCO</option>
                                    <option value="moto_140h">MOTO 140H</option>
                                    <option value="moto_12g">MOTO 12G</option>
                                    <option value="retroexcavadora_580_super_n">Retroexcavadora 580 SUPER N</option>
                                    <option value="retroexcavadora_580_m">Retroexcavadora 580 M</option>
                                    <option value="retroexcavadora_cat_416d">Retroexcavadora CAT 416D</option>
                                    <option value="vibro_cat">VIBRO CAT</option>
                                    <option value="pipa_freightliner">PIPA FREIGHTLINER</option>
                                    <option value="pipa_kenworth">PIPA KENWORTH</option>
                                    <option value="pata_de_cabra_cp_553">PATA DE CABRA CP-553</option>
                                    <option value="bomba_achique_3">BOMBA ACHIQUE 3''</option>
                                </select>
                            </div>

                            <div id="campos_camion" class="camion-fields">
                                <div class="custom-form-group">
                                    <label for="fecha_camion" class="custom-form-label">Fecha:</label>
                                    <input type="date" id="fecha_camion" name="fecha_camion" class="custom-input">
                                </div>
                                <div class="custom-form-group">
                                    <label for="material" class="custom-form-label">Material:</label>
                                    <input type="text" id="material" name="material" class="custom-input">
                                </div>
                                <div class="custom-form-group">
                                    <label for="obra_camion" class="custom-form-label">Obra:</label>
                                    <input type="text" id="obra_camion" name="obra_camion" class="custom-input">
                                </div>
                                <div class="custom-form-group">
                                    <label for="no_viajes" class="custom-form-label">No. de Viajes:</label>
                                    <input type="number" id="no_viajes" name="no_viajes" class="custom-input">
                                </div>
                                <div class="custom-form-group">
                                    <label for="capacidad" class="custom-form-label">Capacidad (m³):</label>
                                    <input type="text" id="capacidad" name="capacidad" class="custom-input">
                                </div>
                                <div class="custom-form-group">
                                    <label for="chofer" class="custom-form-label">Chofer:</label>
                                    <input type="text" id="chofer" name="chofer" class="custom-input">
                                </div>
                                <div class="custom-form-group">
                                    <label for="numero_vale" class="custom-form-label">Número de Vale:</label>
                                    <input type="text" id="numero_vale" name="numero_vale" class="custom-input">
                                </div>
                                <div class="custom-form-group">
                                    <label for="notas_camion" class="custom-form-label">Notas:</label>
                                    <textarea id="notas_camion" name="notas_camion" class="custom-input" rows="4"></textarea>
                                </div>
                            </div>

                            <div id="campos_otra_maquinaria" class="otra-maquinaria-fields">
                                <div class="custom-form-group">
                                    <label for="fecha_otra" class="custom-form-label">Fecha:</label>
                                    <input type="date" id="fecha_otra" name="fecha_otra" class="custom-input">
                                </div>
                                <div class="custom-form-group">
                                    <label for="horometro_salida" class="custom-form-label">Horómetro de Salida:</label>
                                    <input type="text" id="horometro_salida" name="horometro_salida" class="custom-input">
                                </div>
                                <div class="custom-form-group">
                                    <label for="horometro_regreso" class="custom-form-label">Horómetro de Regreso:</label>
                                    <input type="text" id="horometro_regreso" name="horometro_regreso" class="custom-input">
                                </div>
                                <div class="custom-form-group">
                                    <label for="horas_trabajadas" class="custom-form-label">Horas Trabajadas:</label>
                                    <input type="text" id="horas_trabajadas" name="horas_trabajadas" class="custom-input" readonly>
                                </div>
                                <div class="custom-form-group">
                                    <label for="obra_otra" class="custom-form-label">Obra:</label>
                                    <input type="text" id="obra_otra" name="obra_otra" class="custom-input">
                                </div>
                                <div class="custom-form-group">
                                    <label for="operador_reporte_otra" class="custom-form-label">Operador:</label>
                                    <input type="text" id="operador_reporte_otra" name="operador_reporte_otra" class="custom-input">
                                </div>
                                <div class="custom-form-group">
                                    <label for="notas_otra" class="custom-form-label">Notas:</label>
                                    <textarea id="notas_otra" name="notas_otra" class="custom-input" rows="4"></textarea>
                                </div>
                            </div>
                            
                            <button type="submit" class="custom-button">Enviar Reporte</button>
                            <button type="button" class="custom-button limpiar-button" onclick="limpiarFormulario('reporte')">Limpiar Formulario</button>
                            <button type="button" class="custom-button home-button" onclick="mostrarInicio()">Página de Inicio</button>
                        </form>
                    </div>
                `;
            }
        }

        // Función para mostrar los campos específicos de maquinaria
        function mostrarCamposMaquinaria() {
            const maquinaSeleccionada = document.getElementById('maquina').value;
            const camposCamion = document.getElementById('campos_camion');
            const camposOtraMaquinaria = document.getElementById('campos_otra_maquinaria');

            camposCamion.style.display = 'none';
            camposOtraMaquinaria.style.display = 'none';

            if (maquinaSeleccionada === 'camion_azul' || maquinaSeleccionada === 'camion_blanco') {
                camposCamion.style.display = 'block';
            } else if (maquinaSeleccionada) {
                camposOtraMaquinaria.style.display = 'block';
            }

            // Calcular horas trabajadas automáticamente
            const horometroSalida = document.getElementById('horometro_salida');
            const horometroRegreso = document.getElementById('horometro_regreso');
            const horasTrabajadas = document.getElementById('horas_trabajadas');

            if (horometroSalida && horometroRegreso && horasTrabajadas) {
                horometroSalida.addEventListener('input', calcularHorasTrabajadas);
                horometroRegreso.addEventListener('input', calcularHorasTrabajadas);
            }
        }

        function calcularHorasTrabajadas() {
            const salida = parseFloat(document.getElementById('horometro_salida').value);
            const regreso = parseFloat(document.getElementById('horometro_regreso').value);
            const horasTrabajadasInput = document.getElementById('horas_trabajadas');

            if (!isNaN(salida) && !isNaN(regreso) && regreso >= salida) {
                horasTrabajadasInput.value = (regreso - salida).toFixed(2);
            } else if (!isNaN(salida) && !isNaN(regreso) && regreso < salida) {
                 horasTrabajadasInput.value = "";
                 mostrarMensaje("El Horómetro de Regreso no puede ser menor al de Salida.");
            } else {
                horasTrabajadasInput.value = "";
            }
        }

        // Función para mostrar la página de inicio.
        function mostrarInicio() {
            document.getElementById("formulario-container").style.display = "none";
            document.getElementById("menu-principal").style.display = "flex"; // Mostrar el menú principal
        }

        // Función para mostrar un mensaje personalizado.
        function mostrarMensaje(mensaje) {
            const mensajeDiv = document.createElement("div");
            mensajeDiv.className = "mensaje-personalizado";
            mensajeDiv.textContent = mensaje;
            document.body.appendChild(mensajeDiv);

            setTimeout(() => {
                mensajeDiv.remove();
            }, 3000); // El mensaje desaparece después de 3 segundos
        }

        // Lógica para manejar el envío de formularios (delegación de eventos)
        document.addEventListener('DOMContentLoaded', () => {
            // Mostrar la página de inicio al cargar la página
            mostrarInicio(); 

            // *** INICIO DE LÓGICA DE DELEGACIÓN DE EVENTOS ***
            document.addEventListener('submit', async function(event) {
                // Prevenir el comportamiento por defecto de submit del formulario
                event.preventDefault(); 
                
                // Determinar qué formulario se ha enviado
                const formId = event.target.id; 
                console.log("DEBUG: Formulario enviado con ID:", formId);

                if (formId === 'formulario-maquinaria') {
                    await enviarFormulario('maquinaria');
                } else if (formId === 'formulario-vehiculos') {
                    await enviarFormulario('vehiculos');
                } else if (formId === 'maquinariaForm') { // Este es el ID para el formulario de reporte
                    await enviarFormulario('reporte');
                }
            });
        });
        // *** FIN DE LÓGICA DE DELEGACIÓN DE EVENTOS ***

    </script>
</head>
<body>
    <div id="menu-principal" class="menu-principal">
        <h1 style="font-size: 24px; color: #34495e;">BITÁCORA DE MANTENIMIENTOS</h1>
        <p class="info-empresa">Constructora JESAS, S.A. de C.V.</p>
        <p class="info-empresa">C. Privada Villa Hermosa 110, Del Bosque, 89318 Tampico, Tamps.</p>
        <button onclick="mostrarFormulario('maquinaria')" style="background-color: #b0e0e6; color: #2c3e50;">BITÁCORA DE MAQUINARIA</button>
        <button onclick="mostrarFormulario('vehiculos')" style="background-color: #b0e0e6; color: #2c3e50;">BITÁCORA DE VEHÍCULOS</button>
        <button onclick="mostrarFormulario('reporte')" style="background-color: #ffa500; color: #ffffff;">REPORTE DE ACTIVIDADES</button>
    </div>

    <div id="formulario-container" class="formulario-container">
    </div>

    <p class="contacto-soporte">Para soporte, contacta a: <a href="https://wa.me/528334366272" target="_blank">833-436-6272</a></p>

    <img src="https://d2sapt5dytmohl.cloudfront.net/images/upload/92505/sml/660f1cdf9c6527.27633487.jpg" alt="Logo Constructora JESAS" class="imagen-inferior-centrada">
</body>
</html>
